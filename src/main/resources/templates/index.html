<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>System Dashboard</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="/css/bootstrap.min.css" />
    <link rel="stylesheet" href="/css/bootstrap-theme.min.css" />
    <link rel="stylesheet" href="/css/font-awesome.min.css" />
    <script src="/js/jquery-1.12.4.js"></script>
    <script src="/js/sockjs-1.1.1.js"></script>
    <script src="/js/stomp.js"></script>
    <script src="/js/angular.js"></script>
    <script src="/js/bootstrap.js"></script>
    <script src="/js/d3.js"></script>
    <script type="text/javascript">
        var stompClient = null;

        function setConnected(connected) {
            $('#connect').attr('disabled', connected);
            $('#disconnect').attr('disabled', !connected);
            $('#conversationDiv').css('visibility', connected ? 'visible' : 'hidden');
            $('#response').html('');
        }

        function connect() {
            var socket = new SockJS('/stats');
            stompClient = Stomp.over(socket);
            stompClient.connect({}, function(frame) {
                setConnected(true);
                console.log('Connected: ' + frame);
                stompClient.subscribe('/topic/greetings', function(greeting) {
                    showGreeting(JSON.parse(greeting.body).data);
                });
            });
        }

        function disconnect() {
            if (stompClient != null) {
                stompClient.disconnect();
            }
            setConnected(false);
            console.log("Disconnected");
        }

        function sendName() {
            var name = $('#name').val();
            stompClient.send("/app/stats", {}, JSON.stringify({ 'name': name, 'statType': 'system', 'url': 'localhost:8080', 'interval': '1s' }));
        }

        function showGreeting(message) {
            var response = $('#response');
            response.append('<p style="word-wrap:break-word;">' + message + '</p>');
        }
    </script>
</head>
<body>
<noscript><h2 style="color: #ff0000">Seems your browser doesn't support Javascript!  Websocket relies on Javascript being enabled.  Please enable Javascript and reload this page!</h2></noscript>
<p th:text="'Dashboard'" />
<div>
    <div>
        <button class="btn" id="connect" onclick="connect();">Connect</button>
        <button class="btn" id="disconnect" disabled="disabled" onclick="disconnect();">Disconnect</button>
    </div>
    <div id="conversationDiv">
        <label>What is your name?</label><input type="text" id="name" />
        <button class="btn" id="sendName" onclick="sendName();">Send</button>
        <p id="response"></p>
    </div>
</div>
</body>
</html>